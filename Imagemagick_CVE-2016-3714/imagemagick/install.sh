#!/bin/bash

cp -rf ./bin/* /tmp

apt-get update

apt-get install -y php5-mysql php5-dev php5-gd php5-memcache php5-pspell php5-snmp snmp php5-xmlrpc libapache2-mod-php5 php5-cli unzip make

rm -rf /var/www/html/*

tar -zxf /tmp/ImageMagick-6.7.9-10.tar.gz -C /var/www/

tar -zxf /tmp/imagick-3.3.0.tar.gz -C /var/www/

tar -zxf /tmp/re2c-0.13.7.5.tar.gz -C /var/www/

chown -R www-data:www-data /var/www/html/

apt-get install -y build-essential

apt-get build-dep -y imagemagick

cd /var/www/ImageMagick-6.7.9-10

./configure

make clean

make

make install

ldconfig /usr/local/lib

apt-get install -y pkg-config

apt-get install -y libpcre3-dev

cd /var/www/re2c-0.13.7.5

./configure

make

make install

cd /var/www/imagick-3.3.0

/usr/bin/phpize

./configure

make

make test

make install

apt-get install -y php5-imagick

php5enmod imagick

echo "extension=imagick.so" >> /etc/php5/apache2/php.ini

ln -s /etc/php5/mods-available/imagick.ini /etc/php5/apache2/conf.d/20-imagick.ini

rm /etc/php5/mods-available/gd.ini

rm -f /bin/sh

ln -s /bin/bash /bin/sh

mv /tmp/apache2.conf /etc/apache2

service apache2 restart

mv /tmp/index.html /var/www/html/

mv /tmp/upload.html /var/www/html/

mv /tmp/upload_file.php /var/www/html/

mv /tmp/flag.txt /var/www/html/

mkdir /var/www/html/upload

chmod 777 /var/www/html/upload

mkdir /var/www/html/upload/small

chmod 777 /var/www/html/upload/small


